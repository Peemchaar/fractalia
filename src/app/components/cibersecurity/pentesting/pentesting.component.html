<section id="header">
  <div class="container-fluid">
    <ul class="navbar-nav float-left mr-auto ml-3 pl-1">
      <li class="nav-item">
        <small>&nbsp;</small>
      </li>
      <li class="nav-item">
        <h4>{{'CYBERSECURITY.PENTESTING.TITLE' | translate}}</h4>
      </li>
    </ul>
  </div>
</section>

<br/><br/>

<section id="servicestitles" class="mt-5 ml-3 pl-1">
  <div class="container-fluid">
    <div class="service-title mb-5" [innerHTML]="pentestingService.serviceDesc"></div>
    <div class="d-flex justify-content-between d-flex align-items-center">
      <button class="collapse-btn" data-toggle="collapse" data-target="#description-service">
        <div class="icon-book"></div> {{ 'MAS_INFO_SERVICIO' | translate }}
      </button>
      <a class="bback" href="javascript:history.back()">
        <div class="icon-left-big-arrow"></div>{{ 'ATRAS' | translate }}
      </a>
    </div>
    <div id="description-service" class="collapse">
      <div>
        <span [innerHTML]="pentestingService.longDesc"></span>
      </div>
    </div>
  </div>
</section>

<section *ngIf="!loading"  class="dashboard-page ml-3 pl-1">
  <div class="container-fluid">
    <div class="card">
      <div class="container-fluid">
        <div class="row grid-divider justify-content-center">
          <div *ngIf="!pentestingService.hasPentestingInfo" class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12 pt-5">
            <div class="row h-100">
              <div class="col-xl-3 col-lg-2 col-md-1 col-sm-1 col-1 pt-4 mb-2"></div>
              <div class="col-xl-6 col-lg-8 col-md-10 col-sm-10 col-10 pt-4 mb-2">
                  <h6 class="text-center">{{'CYBERSECURITY.PENTESTING.ABOVE_BUTTON_NEW' | translate}}</h6>
                  <p class="text-center">{{'CYBERSECURITY.PENTESTING.TEXT9' | translate}}</p>
                  <div class="d-flex justify-content-center mt-4 mb-2">
                      <div class="newform">
                          <div class="form-group mt-4 mb-2">
                              <input type="url" placeholder="{{'CYBERSECURITY.PENTESTING.URL' | translate}}"
                              maxlength="200" class="form-control d-block mx-auto w-100" id="txtURL1"
                              ng-reflect-maxlength="200" ng-reflect-name="txtUrl1">
                            </div>
                          <p class="form-text text-muted s-text-muted text-left mb-1">{{'CYBERSECURITY.PENTESTING.TEXT7' | translate}}</p>
                            <p class="form-text text-muted s-text-muted text-left mb-3">{{'CYBERSECURITY.PENTESTING.TEXT10' | translate}}</p>
                              <div class="form-group">
                                <div class="custom-control custom-checkbox text-left">
                                  <input type="checkbox" class="custom-control-input" id="checkA1" name="" (change)="checkTerms(1)">
                                  <label class="custom-control-label" for="checkA1">{{'CYBERSECURITY.PENTESTING.CHECK1' | translate}}</label>
                                </div>
                              </div>
                              <div class="form-group">
                                <div class="custom-control custom-checkbox text-left">
                                  <input type="checkbox" class="custom-control-input" id="checkB1" name="" (change)="checkTerms(1)">
                                  <label class="custom-control-label" for="checkB1">{{'CYBERSECURITY.PENTESTING.CHECK2' | translate}}</label>
                                </div>
                              </div>
                          <button id="btnLanzarAnalisis1" type="submit" class="btn btn-primary w-auto mx-auto d-block mb-2 pr-5 pl-5" (click)="lanzarAnalisis(1)" disabled>
                              <div class="icon-analyze"></div>
                              {{'CYBERSECURITY.PENTESTING.BUTTON_PROGRAMING' | translate}}
                          </button>
                      </div>
                  </div>
              </div>
              <div class="col-xl-3 col-lg-2 col-md-1 col-sm-1 col-1 pt-4 mb-2"></div>
            </div>
          </div>

          <div *ngIf="pentestingService.hasPentestingInfo" [class]="pentestingService.AcunetixIMG.reportGenerated !=null ? 'col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12 pt-5': 'col-xl-6 col-lg-8 col-md-10 col-sm-10 col-10 pt-4 mb-2'">
            <div class="datos mb-4">
              <div class="p-0 pr-4 pl-4">
                <div *ngFor="let item of pentestingService.listInput ; let i=index">
                  <div *ngIf="item.status==1" >
                    <h1 class="title text-center">{{'CYBERSECURITY.PENTESTING.TEXT12' | translate}}</h1>
                    <span class="ppal2 mt-3 mb-1 text-center"><font>{{'CYBERSECURITY.PENTESTING.TEXT13' | translate}}</font></span>
                    <span class="ppal2 mb-3 text-center"><font>{{'CYBERSECURITY.PENTESTING.TEXT14' | translate}}</font></span>
                    <div style="text-align: left !important;">
                      <label>{{'CYBERSECURITY.PENTESTING.TEXT15' | translate}}</label>
                    </div>
                  </div>
                  <div *ngIf="item.status==2" >
                    <h1 class="title text-center">{{'CYBERSECURITY.PENTESTING.TEXT16' | translate}}</h1>
                    <span class="ppal2 mt-3 mb-1 text-center"><font>{{'CYBERSECURITY.PENTESTING.TEXT13' | translate}}</font></span>
                    <span class="ppal2 mb-3 text-center"><font>{{'CYBERSECURITY.PENTESTING.TEXT14' | translate}}</font></span>
                    <div style="text-align: left !important;">
                      <span >{{'CYBERSECURITY.PENTESTING.TEXT17' | translate}}</span>
                    </div>
                  </div>
                  <div *ngIf="item.status==3">
                    <h1 class="title text-center mb-4">{{'CYBERSECURITY.PENTESTING.TEXT2' | translate}}</h1>
                  </div>
                  <div *ngIf="item.status!=2; else divStatusElse" class="input-group mb-3" >
                    <input attr.id="txtURL{{item.numUrl}}" type="url" class="form-control" placeholder="https://" maxlength="200"
                    [attr.data-acunetixId]="item.acunetixId" [value]="item.url" disabled/>
                    <div class="input-group-append">
                      <button *ngIf="item.status!=2" type="button" (click)="EnabledTxt(item.numUrl)"><div class="icon-pencil"></div></button>
                    </div>
                  </div>
                  <ng-template #divStatusElse>
                    <h1 class="title text-center mb-3">{{item.url}}</h1>
                  </ng-template>
                <div attr.id="showDisc{{item.numUrl}}" style="display:none">
                  <small class="form-text text-muted s-text-muted text-left">{{'CYBERSECURITY.PENTESTING.TEXT7' | translate}}</small>
                  <small class="form-text text-muted s-text-muted text-left mb-3">{{'CYBERSECURITY.PENTESTING.TEXT10' | translate}}</small>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox text-left">
                      <input type="checkbox" class="custom-control-input" id="checkA{{item.numUrl}}" (change)="checkTerms(item.numUrl)">
                      <label class="custom-control-label" for="checkA{{item.numUrl}}">{{'CYBERSECURITY.PENTESTING.CHECK1' | translate}}</label>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox text-left">
                      <input type="checkbox" class="custom-control-input" id="checkB{{item.numUrl}}" (change)="checkTerms(item.numUrl)">
                      <label class="custom-control-label" for="checkB{{item.numUrl}}">{{'CYBERSECURITY.PENTESTING.CHECK2' | translate}}</label>
                    </div>
                  </div>
                  <button id="btnLanzarAnalisis{{item.numUrl}}" type="button" class="btn btn-primary w-100 mb-3"
                  (click)="lanzarAnalisis(item.numUrl)" disabled>
                    <div class="icon-analyze"></div> {{'CYBERSECURITY.PENTESTING.BUTTON_PROGRAMING' | translate}}
                  </button>
                </div>
                <div class="text-right">
                  <small *ngIf="item.status==3" class="text-muted s-text-muted mt-1 mb-2 g">
                    {{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT23' | translate:{days:item.days } }}
                  </small>
                </div>
                <hr>
                </div>
                <small *ngIf="pentestingService.NumMaxUrl>1"  class="form-text text-muted s-text-muted text-center mt-4">
                  {{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT17' | translate:{numMaxUrl:pentestingService.NumMaxUrl, daysConfig:pentestingService.listInput[0].daysConfig } }}
                  <br>{{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT18' | translate}}
                </small>
                <small *ngIf="pentestingService.NumMaxUrl==1" class="form-text text-muted s-text-muted text-center mt-4">{{'CYBERSECURITY.PENTESTING.TEXT9' | translate}}</small>
              </div>
            </div>
          </div>
          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-xs-12 pt-5"
            *ngIf="pentestingService.ListAcunetixHistory.length>0 && pentestingService.loadAcunetixIMG">
            <h1 class="title text-center mb-5">{{'CYBERSECURITY.PENTESTING.TEXT4' | translate}}</h1>
            <div class="row mb-4">
              <div class="col-xl-6 col-lg-12 col-md-6 col-sm-6 col-xs-6 col-12 mb-4">
                <div class="canvasservices">
                  <div class="numbercanvas text-center numbercanvaswidth" style="top: 60px;">
                    <h3 class="text-center mb-0">{{pentestingService.totalAlerts}}</h3>
                    <span class="subtitle text-center">{{'CYBERSECURITY.PROTECTION.TOTAL_PROTECTED_DEVICES' |
                      translate}}</span>
                  </div>
                  <canvas class="h-90" baseChart [data]="pentestingService.doughnutChartData"
                    [labels]="pentestingService.chartLabels" [colors]="pentestingService.doughnutColors"
                    [chartType]="pentestingService.chartType" width="350" height="250"></canvas>
                </div>
              </div>
              <div class="col-xl-6 col-lg-12 col-md-6 col-sm-6 col-xs-6 col-12 mb-4">
                <div class="datos w50 d-block mx-auto">
                  <h6 class="title text-left mb-4">{{'CYBERSECURITY.PENTESTING.TEXT5' | translate}}</h6>
                  <div class="dg mb-2">
                    <div class="led red">
                      <i class="fas fa-circle"></i>
                    </div>
                    <span>{{'CYBERSECURITY.PENTESTING.CARD.HIGH' | translate}}</span>
                    <h4 class="">{{pentestingService.AcunetixIMG.reportAlertsHigh}}</h4>
                  </div>
                  <div class="dg mb-2">
                    <div class="led orange">
                      <i class="fas fa-circle"></i>
                    </div>
                    <span>{{'CYBERSECURITY.PENTESTING.CARD.MEDIUM' | translate}}</span>
                    <h4 class="">{{pentestingService.AcunetixIMG.reportAlertsMedium}}</h4>
                  </div>
                  <div class="dg mb-2">
                    <div class="led green">
                      <i class="fas fa-circle"></i>
                    </div>
                    <span>{{'CYBERSECURITY.PENTESTING.CARD.LOW' | translate}}</span>
                    <h4 class="">{{pentestingService.AcunetixIMG.reportAlertsLow}}</h4>
                  </div>
                  <div class="dg mb-2">
                    <div class="led purple">
                      <i class="fas fa-circle"></i>
                    </div>
                    <span>{{'CYBERSECURITY.PENTESTING.CARD.INFO' | translate}}</span>
                    <h4 class="">{{pentestingService.AcunetixIMG.reportAlertsInfo}}</h4>
                  </div>
                  <hr>
                  <span class="ppal4">{{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT10' | translate}} <font>
                      {{pentestingService.AcunetixIMG.reportScanMinutes}} min</font></span>
                  <span class="ppal4">{{'CYBERSECURITY.PENTESTING.CARD.PAGES' | translate}}<font>
                    {{pentestingService.AcunetixIMG.reportPages}}</font></span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12 pt-5"
            *ngIf="pentestingService.ListAcunetixHistory.length>0 && pentestingService.loadAcunetixIMG">
            <div class="datos mb-4">
              <h1 class="title text-center mb-4">{{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT8' | translate}}</h1>
              <span class=" text-center ppal mb-2">
                <font>{{ (pentestingService.AcunetixIMG.reportGenerated.toString()+ 'Z').toLocaleString() | date:'dd/MM/yyyy HH:mm:ss'}}</font>
              </span>
              <span class=" text-centerr" mb-2>{{'CYBERSECURITY.PENTESTING.MESSAGE.TEXT9' | translate : {days :
                pentestingService.AcunetixIMG.days} }}</span>
              <span class=" text-center ppal2 g mb-2">{{pentestingService.AcunetixIMG.url}}</span>
              <div class="mt-4 d-block mx-auto" style="max-width: 220px;">
                <a class="text-center btn btn-primary w-100" (click)="getLastReport()" target="_blank">
                  <div class="icon-download"></div> {{'CYBERSECURITY.PENTESTING.BUTTON_LAST_REPORT' | translate}}
                </a>
                <button class="text-center btn btn-outline-secondary mt-3 d-flex justify-content-between"
                 (click)="ScrollHistory()" style="width: 100%;">
                  {{'CYBERSECURITY.PENTESTING.BUTTON_OTHER_REPORTS' | translate}} <div class="icon-bottom-arrow"></div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />
    <hr>
    <br />
    <h1 *ngIf="pentestingService.hasHistory" class="title mb-4">{{'CYBERSECURITY.PENTESTING.REPORTS' |
      translate}}</h1>
    <div *ngIf="pentestingService.hasHistory" class="table-responsive" id="headerList" >
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th scope="col">{{'CYBERSECURITY.PENTESTING.COLUMNS.URL' | translate}}</th>
            <th scope="col">{{'CYBERSECURITY.PENTESTING.COLUMNS.DATE' | translate}}</th>
            <th scope="col">
              <div class="led red"><i class="fas fa-circle"></i></div> {{'CYBERSECURITY.PENTESTING.COLUMNS.ALERT_HIGH' | translate}}
            </th>
            <th scope="col">
              <div class="led orange"><i class="fas fa-circle"></i></div>
              {{'CYBERSECURITY.PENTESTING.COLUMNS.ALERT_MEDIUM' | translate}}
            </th>
            <th scope="col">
              <div class="led green"><i class="fas fa-circle"></i></div> {{'CYBERSECURITY.PENTESTING.COLUMNS.ALERT_LOW' | translate}}
            </th>
            <th scope="col">
              <div class="led purple"><i class="fas fa-circle"></i></div>
              {{'CYBERSECURITY.PENTESTING.COLUMNS.ALERT_INFO' | translate}}
            </th>
            <th scope="col">{{'CYBERSECURITY.PENTESTING.COLUMNS.DOWNLOAD_REPORT' | translate}}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of pentestingService.ListAcunetixHistory">
            <th scope="row">{{item.url}} </th>
            <td><i class="far fa-calendar-alt icon"></i> {{ (item.reportGenerated + 'Z').toLocaleString() | date:
              'dd/MM/yyyy HH:mm:ss'}} </td>
            <td>{{item.reportAlertsHigh}}</td>
            <td>{{item.reportAlertsMedium}}</td>
            <td>{{item.reportAlertsLow}}</td>
            <td>{{item.reportAlertsInfo}}</td>
            <td><a class="btn btn-primary" (click)="getPDF(item.acunetixId)" target="_blank">
                <div class="icon-download"></div>
              </a></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
